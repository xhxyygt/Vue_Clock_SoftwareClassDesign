<html>
<head>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
			padding: 0;
            /* background-color: rgb(171, 213, 238); */
        }
        /* 顶部菜单栏显示 */
        nav {
			background-color: #333;
			height: 50px;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
		}
		nav ul {
			margin: 0;
			padding: 0;
			list-style: none;
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100%;
		}
		nav li {
			margin: 0 10px;
		}
		nav a {
			color: white;
			text-decoration: none;
			padding: 5px 10px;
			border-radius: 5px;
			transition: all 0.3s ease-in-out;
		}
		nav a:hover {
			background-color: white;
			color: #333;
		}


        .timer {
            margin: 20px auto;
            width: 300px;
            height: 300px;
            /* border: 10px solid black; */
            border-radius: 50%;
            position: relative;
        }

        .timer h1 {
            font-size: 60px;
            margin: 0;
            padding: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .timer p {
            font-size: 20px;
            margin: 0;
            padding: 0;
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
        }

        .timer svg {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .timer circle {
            /* r =140 */
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            transform-origin: 50% 50%;
        }
        .progress-mask{
            stroke-dasharray: 1.2 8.8;
            stroke-width: 10;
            stroke-linecap: butt;
            fill:transparent;


        }
        .timer circle.background {
            stroke: lightgray;
            /* stroke-dasharray: 1.2 8.8; */
            stroke-linecap: butt;
            transform: rotate(-90deg);

        }

        .timer circle.progress {
            /* 圆圈为虚线，间隔和每一段都很短 */
            /* stroke: gray; */
            stroke: rgb(19, 143, 184);
            /* stroke-dasharray: 1.2 8.8; */
            stroke-dasharray: 880 880;
            /* 虚线边界为直角 */
            /* stroke-linecap: butt; */

            transform: rotate(-90deg);

        
            /* stroke: gray;
            transition: stroke-dashoffset 0.5s linear;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        
            
            stroke-dasharray: 40;
            stroke-dashoffset: 40; */

        }

        .buttons {
            margin: 20px auto;
            width: 300px;
            display: flex;
            justify-content: space-between;
        }


        .buttons button {
            width: 100px;
            height: 50px;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            color: white;
            cursor: pointer;
        }

        .buttons button.pause {
            background-color: orange;
        }

        .buttons button.stop {
            background-color: red;
        }

        .settings {
            margin: 20px auto;
            width: 300px;
            height: 300px;
            display: grid;
            /* grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(5, 1fr); */
            grid-template-columns: 5fr 1fr 5fr 1fr 5fr 1fr;
            grid-template-rows: repeat(5, 1fr);
            grid-gap: 10px;
            align-items: center;
            justify-items: center;
            
            /* 整个块在页面的上下居中 */
            position: relative;
            transform: translateY(40%);
        }

        .settings button {
            grid-column: span 2;
            grid-row: 1 / 2;
            width: 50px;
            height: 50px;
            margin-top: 10%;
            border: none;
            border-radius: 50%;
            font-size: 30px;
            color: white;
            background-color: blue;
            cursor: pointer;
        }

        .settings button.decrease {
            transform: rotate(180deg);
            grid-row: 5 / 6;
        }

        .settings span {
            font-size: 40px;
            font-weight: bold;
        }

        .settings span.dim {
            grid-column: span 2;
            font-size: 30px;
            font-weight: normal;
            color: gray;
        }
        .settings span.time-set{
            text-align: right;
            grid-row: 3/4;
        }
        .settings span#hour {grid-column: 1/3;}
        .settings span#minute {grid-column: 3/5;}
        .settings span#second {grid-column: 5/7;}
        /* .settings span#hour::after {content: "时";}
        .settings span#minute::after {content: "分"; font-size: medium; font-weight: normal;}
        .settings span#second::after {content: "秒";} */
        .settings span.label {
            font-size: 15px;
            font-weight: normal;
            grid-row: 3/4;
        }
        .settings span#label-h {grid-column: 2/3;}
        .settings span#label-m {grid-column: 4/5;}
        .settings span#label-s {grid-column: 6/7;}
        
        .settings button.start {
            grid-column: 1 / 7;
            grid-row: 6 / 7;
            width: 200px;
            height: 50px;
            border-radius: 10px;
            font-size: 20px;
            color: white;
            background-color: green;
        }
        .alert {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #f8f8f8;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 9999;
        }

/*消息提示框*/
  #message-box {
    /* 消息框阴影 */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2), inset 0 0 10px rgba(255, 255, 255, 0.2);
    border: 1px solid #ccc;
    border-radius: 10px;
    background: linear-gradient(to bottom, #f0f0f0, #e0e0e0);
    /* 消息框在页面底部，左右居中 */
    position: fixed;
    bottom: 50%;
    margin-bottom: 0px;
    padding: 10px;
    width: 300px;

    text-align: center;
    color: #333;
    font-size: 20px;
    line-height: 1.5;

    /* 消息框的层级 */
    z-index: 9999;
  }

  /* 为按钮添加纹理和细节 */
  #ok-button {
    background: linear-gradient(to bottom, #f0f0f0, #d0d0d0);
    width: 60px;
    height: 40px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1), inset 0 1px 1px rgba(255, 255, 255, 0.2);
    font-size: 16px;
    padding: 5px 10px;
  }

  /* 为按钮添加点击效果 */
  #ok-button:active {
    background: linear-gradient(to bottom, #d0d0d0, #f0f0f0);
    box-shadow: inset 0 1px 5px rgba(0, 0, 0, 0.2), inset 0 -1px 1px rgba(255, 255, 255, 0.2);
  }
    </style>
</head>
<body>
    <nav>
        <ul>
            <li><a href="../Main-top.html">闹钟</a></li>
            <li><a href="../world_clock/worldclock.html">世界时钟</a></li>
            <li><a href="../Stoptimer/stoptimer.html">秒表</a></li>
            <li><a href="#">计时器</a></li>
            <li><a href="../Calender/calendar-1.html">日历</a></li>
            <li><a href="#">睡眠追踪</a></li>
        </ul>
    </nav>

    <!-- 计时页面 -->
    <div class="timer" id="timer" style="display: none;">
        <h1 id="time">00:00:00</h1>
        <p id="total">共00秒</p>
        <svg>
            <mask id="progress-mask">
                <!-- 用path绘制圆心在150，150，半径140的圆-->
                <path  class="progress-mask" d="M 150 10
                        A 140 140 0 0 1 150 290
                        A 140 140 0 0 1 150 10" fill="none" stroke="white" stroke-width="20"></path>
                <!-- <circle r="140" cx="150" cy="150" :stroke-dasharray="1.2 8.8" stroke-dasharray: 1.2 8.8;stroke-width="12" stroke="black"></circle> -->
            </mask>
            <circle class="background" r="140" cx="150" cy="150" mask="url(#progress-mask)"></circle>
            <circle class="progress" r="140" cx="150" cy="150" id="progress" mask="url(#progress-mask)"></circle>
        </svg>
    </div>
    <div class="buttons" id="buttons" style="display: none;">
        <button class="pause" id="pause">暂停</button>
        <button class="stop" id="stop">停止</button>
    </div>

    <!-- 设定页面 -->
    <div class="settings" id="settings">
        <button class="increase" id="hour-increase" >▲</button>
        <button class="increase" id="minute-increase">▲</button>
        <button class="increase" id="second-increase">▲</button>
        <span class="dim" id="hour-prev">23</span>
        <span class="dim" id="minute-prev">59</span>
        <span class="dim" id="second-prev">59</span>
        <span class="time-set" id="hour">00</span>
        <span class="label" id="label-h">时</span>
        <span class="time-set" id="minute">00</span>
        <span class="label" id="label-m">分</span>
        <span class="time-set" id="second">00</span>
        <span class="label" id="label-s">秒</span>
        <span class="dim" id="hour-next">01</span>
        <span class="dim" id="minute-next">01</span>
        <span class="dim" id="second-next">01</span>
        <button class="decrease" id="hour-decrease">▲</button>
        <button class="decrease" id="minute-decrease">▲</button>
        <button class="decrease" id="second-decrease">▲</button>
        <button class="start" id="start">开始计时</button>

        <!--消息提示框-->
        <dialog id="message-box">
            <!-- 创建一个空的<p>元素，用来显示文本内容 -->
            <p id="message-text"></p>
            <!-- 创建一个按钮，点击后关闭对话框 -->
            <button id="ok-button">确定</button>
        </dialog>
    </div>
    <div><audio id="my-audio" src="output.wav"></audio></div>
    
    
    <script>
        // 获取元素
        const timer = document.getElementById("timer");
        const buttons = document.getElementById("buttons");
        const settings = document.getElementById("settings");
        const hour = document.getElementById("hour");
        const minute = document.getElementById("minute");
        const second = document.getElementById("second");
        const hourPrev = document.getElementById("hour-prev");
        const minutePrev = document.getElementById("minute-prev");
        const secondPrev = document.getElementById("second-prev");
        const hourNext = document.getElementById("hour-next");
        const minuteNext = document.getElementById("minute-next");
        const secondNext = document.getElementById("second-next");
        const hourIncrease = document.getElementById("hour-increase");
        const minuteIncrease = document.getElementById("minute-increase");
        const secondIncrease = document.getElementById("second-increase");
        const hourDecrease = document.getElementById("hour-decrease");
        const minuteDecrease = document.getElementById("minute-decrease");
        const secondDecrease = document.getElementById("second-decrease");
        const start = document.getElementById("start");
        const time = document.getElementById("time");
        const total = document.getElementById("total");
        const progress = document.getElementById("progress");
        const pause = document.getElementById("pause");
        const stop = document.getElementById("stop");

        // 定义变量
        let hourValue = 0;
        let minuteValue = 0;
        let secondValue = 0;
        let duration = 0;
        let remaining = 0;
        let remaining_svg = 0;
        let interval = null;
        let paused = false;
        var audio = document.getElementById("my-audio");
        // 定义函数
        function formatNumber(num) {
            // 格式化数字，如果小于10则在前面加0
            return num < 10 ? "0" + num : num;
        }

        function updateSettings() {
            // 更新设置页面的显示
            hour.textContent = formatNumber(hourValue);
            minute.textContent = formatNumber(minuteValue);
            second.textContent = formatNumber(secondValue);
            hourPrev.textContent = formatNumber((hourValue + 23) % 24);
            minutePrev.textContent = formatNumber((minuteValue + 59) % 60);
            secondPrev.textContent = formatNumber((secondValue + 59) % 60);
            hourNext.textContent = formatNumber((hourValue + 1) % 24);
            minuteNext.textContent = formatNumber((minuteValue + 1) % 60);
            secondNext.textContent = formatNumber((secondValue + 1) % 60);
        }
        function updateTimer() {
            // 更新计时页面的显示
            time.textContent = formatNumber(Math.floor(remaining / 3600)) + ":" + formatNumber(Math.floor(remaining / 60) % 60) + ":" + formatNumber(remaining % 60);
            // total.textContent = "共" + duration + "秒";
            // 根据设定时间分别显示共xx秒或共xx分xx秒或共xx小时xx分xx秒
            if (duration < 60) {
                total.textContent = "共" + duration + "秒";
            } else if (duration < 3600) {
                total.textContent = "共" + Math.floor(duration / 60) + "分" + (duration % 60) + "秒";
            } else {
                total.textContent = "共" + Math.floor(duration / 3600) + "小时" + Math.floor(duration / 60) % 60 + "分" + (duration % 60) + "秒";
            }
            progress.style.strokeDashoffset = 880 * (1 - remaining_svg / (duration*50));
            // 根据剩余时间更新进度条progress的长度

        }

        function startTimer() {
            // 开始计时
            duration = hourValue * 3600 + minuteValue * 60 + secondValue;
            remaining = duration;
            remaining_svg = duration*50; //提高帧率
            if (duration > 0) {
                // 如果设定的时间大于0，则切换到计时页面，并设置定时器
                settings.style.display = "none";
                timer.style.display = "block";
                buttons.style.display = "flex";
                updateTimer();
                interval = setInterval(function () {
                    // 每隔一秒，剩余时间减一，并更新显示
                    // remaining--;
                    // 每次循环剩余svg时间-1
                    remaining_svg--;
                    //向上取整
                    remaining = Math.ceil(remaining_svg/50);
                    updateTimer();
                    if (remaining <= 0) {
                        //如果剩余时间小于等于0，则停止计时，并播放一个提示音，然后切换回设置页面
                    clearInterval(interval);
                    playAudio();
                    showEndMessage();
                    timer.style.display = "none";
                    buttons.style.display = "none";
                    settings.style.display = "grid";


                }
            // }, 1000);
                }, 20);
        } else {
            // 如果设定的时间等于0，则提示用户输入一个有效的时间
            alert("请输入一个有效的时间");
        }
    }

    function showMessage(messagetext){
        var messageBox = document.getElementById("message-box");
        var messageText = document.getElementById("message-text");
        var  okButton = document.getElementById("ok-button");

        // 为按钮添加点击事件监听器，关闭对话框
        okButton.addEventListener("click", function() {
            messageBox.close();
            stopAudio();
        });
        messageText.innerHTML = messagetext;
        messageBox.showModal();
    }

    function showEndMessage() {
        showMessage("倒计时结束！");
    }
    // function showEndMessage() {
    //         var alertBox = document.createElement("div");
    //         alertBox.className = "alert";
            
    //         var message = document.createElement("p");
    //         message.innerHTML = "倒计时结束！";
    //         message.style.fontSize = "24px";
    //         message.style.marginBottom = "10px";
            
    //         var closeButton = document.createElement("button");
    //         closeButton.innerHTML = "确定";
    //         closeButton.style.padding = "5px 10px";
    //         closeButton.style.fontSize = "16px";
    //         closeButton.style.backgroundColor = "#ccc";
    //         closeButton.style.border = "none";
    //         closeButton.style.borderRadius = "3px";
    //         closeButton.style.cursor = "pointer";
    //         closeButton.onclick = function() {
    //             document.body.removeChild(alertBox); // 点击关闭按钮时移除提示框
    //             stopAudio();
    //         };

    //         alertBox.appendChild(message);
    //         alertBox.appendChild(closeButton);

    //         document.body.appendChild(alertBox);
    //     }

    function playAudio() {
        audio.loop = true; // 设置循环播放
        audio.play();
    }

    function stopAudio() {
        audio.loop = false; // 取消循环播放
        audio.pause();
        audio.currentTime = 0;
    }
    function pauseTimer() {
        // 暂停或恢复计时
        if (paused) {
            // 如果已经暂停，则恢复计时，并修改按钮的文本
            interval = setInterval(function () {
                remaining--;
                updateTimer();
                if (remaining <= 0) {
                    clearInterval(interval);
                    let audio = new Audio("beep.mp3");
                    audio.play();
                    timer.style.display = "none";
                    buttons.style.display = "none";
                    settings.style.display = "grid";
                }

            }, 1000);
            pause.textContent = "暂停";
            paused = false;
        } else {
            // 如果正在计时，则暂停计时，并修改按钮的文本
            clearInterval(interval);
            pause.textContent = "继续";
            paused = true;
        }
    }

    function stopTimer() {
        // 停止计时
        clearInterval(interval);
        timer.style.display = "none";
        buttons.style.display = "none";
        settings.style.display = "grid"; //用grid而不用block防止排版失效
    }

    function increaseHour() {
        // 增加小时的值，并更新设置页面的显示
        hourValue = (hourValue + 1) % 24;
        updateSettings();
    }

    function increaseMinute() {
        // 增加分钟的值，并更新设置页面的显示
        minuteValue = (minuteValue + 1) % 60;
        updateSettings();
    }

    function increaseSecond() {
        // 增加秒钟的值，并更新设置页面的显示
        secondValue = (secondValue + 1) % 60;
        updateSettings();
    }

    function decreaseHour() {
        // 减少小时的值，并更新设置页面的显示
        hourValue = (hourValue + 23) % 24;
        updateSettings();
    }

    function decreaseMinute() {
        // 减少分钟的值，并更新设置页面的显示
        minuteValue = (minuteValue + 59) % 60;
        updateSettings();
    }

    function decreaseSecond() {
        // 减少秒钟的值，并更新设置页面的显示
        secondValue = (secondValue + 59) % 60;
        updateSettings();
    }

    // 添加事件监听器
    start.addEventListener("click", startTimer);
    pause.addEventListener("click", pauseTimer);
    stop.addEventListener("click", stopTimer);
    hourIncrease.addEventListener("click", increaseHour);
    minuteIncrease.addEventListener("click", increaseMinute);
    secondIncrease.addEventListener("click", increaseSecond);
    hourDecrease.addEventListener("click", decreaseHour);
    minuteDecrease.addEventListener("click", decreaseMinute);
    secondDecrease.addEventListener("click", decreaseSecond);

    // 初始化设置页面的显示
    updateSettings();
</script>
</body>
</html>

